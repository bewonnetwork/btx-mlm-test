<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BTX.ONE ‚Äì Admin Panel (Demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif}
    body{
      min-height:100vh;
      background:radial-gradient(circle at top,#020617,#020617 60%);
      color:#e5f0ff;
      padding:16px;
    }
    a{color:#38bdf8;text-decoration:none}
    .shell{max-width:1200px;margin:0 auto;}

    /* HEADER */
    .admin-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:16px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand img{
      width:46px;height:46px;border-radius:999px;
      object-fit:cover;
      box-shadow:0 0 24px rgba(59,130,246,.95);
    }
    .brand-title h1{
      font-size:18px;
      letter-spacing:.22em;
      text-transform:uppercase;
    }
    .brand-title p{
      font-size:11px;
      color:#9ca3af;
      margin-top:2px;
    }
    .header-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .btn-sm,
    .btn-outline-sm{
      border-radius:999px;
      padding:7px 14px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      cursor:pointer;
    }
    .btn-sm{
      border:none;
      background:linear-gradient(135deg,#38bdf8,#22c55e);
      color:#020617;
      box-shadow:0 14px 32px rgba(56,189,248,.85);
    }
    .btn-outline-sm{
      border:1px solid rgba(148,163,184,.7);
      background:rgba(15,23,42,.9);
      color:#e5e7eb;
    }

    /* MAIN CARD */
    .card-main{
      position:relative;
      border-radius:26px;
      padding:16px 16px 18px;
      background:linear-gradient(135deg,rgba(15,23,42,.98),rgba(30,64,175,.96));
      box-shadow:
        0 0 0 2px rgba(56,189,248,.7),
        0 26px 70px rgba(0,0,0,.9);
      overflow:hidden;
    }
    .glow{
      position:absolute;inset:-90px;
      background:
        radial-gradient(circle at 0 0,rgba(56,189,248,.25),transparent 60%),
        radial-gradient(circle at 100% 100%,rgba(74,222,128,.25),transparent 60%);
      opacity:.9;pointer-events:none;
    }
    .inner{position:relative;z-index:1;}

    /* TABS */
    .tabs{
      display:flex;
      gap:8px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .tab-btn{
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      cursor:pointer;
      background:rgba(15,23,42,.92);
      color:#cbd5f5;
      border:1px solid rgba(148,163,184,.6);
    }
    .tab-btn.active{
      background:linear-gradient(135deg,#38bdf8,#22c55e);
      color:#020617;
      box-shadow:0 10px 28px rgba(56,189,248,.9);
      border-color:transparent;
    }

    .tab-section{display:none;margin-top:6px;}
    .tab-section.active{display:block;}

    /* TABLE */
    .table-wrap{
      border-radius:16px;
      padding:10px;
      background:rgba(15,23,42,.96);
      box-shadow:0 0 0 1px rgba(148,163,184,.5);
      font-size:11px;
      margin-bottom:12px;
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      min-width:650px;
    }
    th,td{padding:4px 6px;text-align:left;}
    th{
      color:#9ca3af;
      border-bottom:1px solid rgba(51,65,85,.8);
      position:sticky;
      top:0;
      background:rgba(15,23,42,1);
      z-index:1;
    }
    td{border-top:1px solid rgba(15,23,42,1);}
    .status-pending{color:#fbbf24;}
    .status-approved{color:#4ade80;}
    .status-rejected{color:#f97373;}

    .btn-table{
      border-radius:999px;
      padding:2px 8px;
      font-size:10px;
      border:none;
      cursor:pointer;
      margin-right:3px;
    }
    .btn-approve{
      background:#22c55e;color:#022c22;
    }
    .btn-reject{
      background:#f97373;color:#450a0a;
    }
    .btn-edit{
      background:#38bdf8;color:#02101f;
    }

    /* EDIT FORM */
    .edit-wrap{
      border-radius:16px;
      padding:10px 10px 8px;
      background:rgba(15,23,42,.96);
      box-shadow:0 0 0 1px rgba(148,163,184,.5);
      font-size:11px;
    }
    .edit-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:8px;
      margin-top:6px;
    }
    label{display:block;color:#e5e7eb;margin-bottom:3px;}
    .field{
      border-radius:999px;
      padding:6px 10px;
      background:rgba(15,23,42,1);
      box-shadow:0 0 0 1px rgba(148,163,184,.7);
    }
    .field input,
    .field select{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:#e5f0ff;
      font-size:12px;
    }
    .btn-save{
      margin-top:8px;
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      background:linear-gradient(135deg,#4ade80,#22c55e);
      color:#022c22;
      cursor:pointer;
      box-shadow:0 16px 40px rgba(74,222,128,.9);
    }

    .note{
      margin-top:6px;
      font-size:10px;
      color:#9ca3af;
    }

    @media(max-width:640px){
      body{padding:10px;}
      .admin-header{flex-direction:column;align-items:flex-start;gap:8px;}
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- HEADER -->
    <header class="admin-header">
      <div class="brand">
        <img src="images/logo.png" alt="BTX Logo">
        <div class="brand-title">
          <h1>BTX.ONE</h1>
          <p>USDT MLM ‚Ä¢ Admin Panel (Demo)</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn-outline-sm" onclick="goDashboard()">Dashboard</button>
        <button class="btn-outline-sm" onclick="resetDemo()">Clear Data</button>
        <button class="btn-sm" onclick="adminLogout()">Logout</button>
      </div>
    </header>

    <!-- MAIN -->
    <section class="card-main">
      <div class="glow"></div>
      <div class="inner">

        <!-- TABS -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="users" onclick="switchTab('users',this)">Users</button>
          <button class="tab-btn" data-tab="deposits" onclick="switchTab('deposits',this)">Deposits</button>
          <button class="tab-btn" data-tab="withdraws" onclick="switchTab('withdraws',this)">Withdraws</button>
        </div>

        <!-- USERS TAB -->
        <section id="tab-users" class="tab-section active">
          <div class="table-wrap">
            <strong>All Members (demo)</strong>
            <table>
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Full Name</th>
                  <th>Email</th>
                  <th>Mobile</th>
                  <th>Country</th>
                  <th>Role</th>
                  <th>Membership</th>
                  <th>Balance</th>
                  <th>Team</th>
                  <th>Ref</th>
                  <th>Joined</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="userTableBody"></tbody>
            </table>
          </div>

          <!-- EDIT FORM -->
          <div class="edit-wrap">
            <strong>Edit Member (demo)</strong>
            <form id="editUserForm">
              <input type="hidden" id="editUserId" />

              <div class="edit-grid">
                <div>
                  <label>Username</label>
                  <div class="field">
                    <input id="editUsername" type="text" disabled />
                  </div>
                </div>
                <div>
                  <label>Full Name</label>
                  <div class="field">
                    <input id="editFullName" type="text" />
                  </div>
                </div>
                <div>
                  <label>Email</label>
                  <div class="field">
                    <input id="editEmail" type="email" />
                  </div>
                </div>
                <div>
                  <label>Mobile</label>
                  <div class="field">
                    <input id="editMobile" type="text" />
                  </div>
                </div>
                <div>
                  <label>Country</label>
                  <div class="field">
                    <input id="editCountry" type="text" />
                  </div>
                </div>
                <div>
                  <label>Role</label>
                  <div class="field">
                    <select id="editRole">
                      <option value="member">Member</option>
                      <option value="admin">Admin</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label>Membership Type</label>
                  <div class="field">
                    <select id="editMembership">
                      <option value="free">Free</option>
                      <option value="premium">Premium</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label>Balance (USDT)</label>
                  <div class="field">
                    <input id="editBalance" type="number" step="0.01" />
                  </div>
                </div>
                <div>
                  <label>Total Deposit</label>
                  <div class="field">
                    <input id="editDepositTotal" type="number" step="0.01" />
                  </div>
                </div>
                <div>
                  <label>Direct Income</label>
                  <div class="field">
                    <input id="editDirectIncome" type="number" step="0.01" />
                  </div>
                </div>
                <div>
                  <label>Team Income</label>
                  <div class="field">
                    <input id="editTeamIncome" type="number" step="0.01" />
                  </div>
                </div>
                <div>
                  <label>Team Count</label>
                  <div class="field">
                    <input id="editTeamCount" type="number" step="1" />
                  </div>
                </div>
                <div>
                  <label>Referral Code (raw)</label>
                  <div class="field">
                    <input id="editRefCode" type="text" />
                  </div>
                </div>
                <div>
                  <label>Sponsor Username</label>
                  <div class="field">
                    <input id="editSponsor" type="text" />
                  </div>
                </div>
                <div>
                  <label>Password (plain ‚Äì demo)</label>
                  <div class="field">
                    <input id="editPassword" type="text" />
                  </div>
                </div>
              </div>

              <button type="submit" class="btn-save">SAVE CHANGES</button>
            </form>
            <p class="note">
              ‚ö† ‡¶∂‡ßÅ‡¶ß‡ßÅ demo ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø admin ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡¶õ‡ßá (password ‡¶∏‡¶π)‡•§ Real ‡¶™‡ßç‡¶∞‡ßã‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á password hash ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
              ‡¶Ü‡¶∞ admin panel ‡¶•‡ßá‡¶ï‡ßá password ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ, ‡¶∂‡ßÅ‡¶ß‡ßÅ reset ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§
            </p>
          </div>
        </section>

        <!-- DEPOSITS TAB -->
        <section id="tab-deposits" class="tab-section">
          <div class="table-wrap">
            <strong>All Deposit Requests (demo)</strong>
            <table>
              <thead>
                <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Txn</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="depAdminBody"></tbody>
            </table>
          </div>
          <p class="note">
            ‚úÖ Deposit APPROVE ‡¶ï‡¶∞‡¶≤‡ßá member.balance ‡¶ì member.depositTotal ‡¶¶‡ßÅ‡¶ü‡ßã‡¶á ‡¶¨‡¶æ‡ßú‡¶¨‡ßá‡•§ REJECT ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá‡•§
          </p>
        </section>

        <!-- WITHDRAWS TAB -->
        <section id="tab-withdraws" class="tab-section">
          <div class="table-wrap">
            <strong>All Withdraw Requests (demo)</strong>
            <table>
              <thead>
                <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Wallet</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="wdAdminBody"></tbody>
            </table>
          </div>
          <p class="note">
            ‚úÖ Withdraw APPROVE ‡¶ï‡¶∞‡¶≤‡ßá member.balance ‡¶•‡ßá‡¶ï‡ßá amount ‡¶ï‡¶æ‡¶ü‡¶æ ‡¶π‡¶¨‡ßá (‡¶Ø‡¶¶‡¶ø sufficient balance ‡¶•‡¶æ‡¶ï‡ßá),
            ‡¶®‡¶æ‡¶π‡¶≤‡ßá auto REJECT ‡¶ï‡¶∞‡¶¨‡ßá (demo).
          </p>
        </section>

      </div>
    </section>
  </div>

  <script>
    const STORAGE_USERS      = "btx_users_v1";
    const STORAGE_CURRENT    = "btx_current_user_v1";
    const STORAGE_DEPOSITS   = "btx_deposits_v1";
    const STORAGE_WITHDRAWS  = "btx_withdraws_v1";

    function loadUsers(){
      const raw = localStorage.getItem(STORAGE_USERS);
      if(!raw) return [];
      try{return JSON.parse(raw);}catch(e){return [];}
    }
    function saveUsers(list){
      localStorage.setItem(STORAGE_USERS, JSON.stringify(list));
    }
    function getCurrentUser(){
      const raw = localStorage.getItem(STORAGE_CURRENT);
      if(!raw) return null;
      try{return JSON.parse(raw);}catch(e){return null;}
    }
    function loadDeposits(){
      const raw = localStorage.getItem(STORAGE_DEPOSITS);
      if(!raw) return [];
      try{return JSON.parse(raw);}catch(e){return [];}
    }
    function saveDeposits(list){
      localStorage.setItem(STORAGE_DEPOSITS, JSON.stringify(list));
    }
    function loadWithdraws(){
      const raw = localStorage.getItem(STORAGE_WITHDRAWS);
      if(!raw) return [];
      try{return JSON.parse(raw);}catch(e){return [];}
    }
    function saveWithdraws(list){
      localStorage.setItem(STORAGE_WITHDRAWS, JSON.stringify(list));
    }

    function goDashboard(){
      window.location.href = "dashboard.html";
    }
    function adminLogout(){
      localStorage.removeItem(STORAGE_CURRENT);
      alert("Admin logged out (demo).");
      window.location.href = "login.html";
    }

    // üî• CLEAR DATA ‚Äì only from Admin
    function resetDemo(){
      if(!confirm("‡¶∏‡¶¨ demo data (users, deposits, withdraws) clear ‡¶π‡¶¨‡ßá‡•§ ‡¶∂‡ßÅ‡¶ß‡ßÅ current admin ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡¶®‡•§ Proceed?")) return;

      const me = getCurrentUser();
      let users = loadUsers();

      if(me){
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ current admin ‡¶∞‡ßá‡¶ñ‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø‡¶¶‡ßá‡¶∞ ‡¶¨‡¶æ‡¶¶
        users = users.filter(u => u.id === me.id);
        if(users.length === 1){
          const a = users[0];
          a.balance      = 0;
          a.depositTotal = 0;
          a.directIncome = 0;
          a.teamIncome   = 0;
          a.teamCount    = 0;
        }
      }else{
        users = [];
      }

      saveUsers(users);
      saveDeposits([]);
      saveWithdraws([]);

      // login count ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡ßç‡¶≤‡¶ø‡¶®
      for(let i=localStorage.length-1;i>=0;i--){
        const key = localStorage.key(i);
        if(key && key.startsWith("btx_login_count_")){
          localStorage.removeItem(key);
        }
      }

      alert("Demo data cleared. ‡¶∂‡ßÅ‡¶ß‡ßÅ current admin ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá (‡¶Ø‡¶¶‡¶ø logged-in ‡¶•‡¶æ‡¶ï‡ßá)‡•§");
      renderUsers();
      renderDeposits();
      renderWithdraws();
    }

    // TAB SWITCH
    function switchTab(name,btn){
      document.querySelectorAll(".tab-section").forEach(s=>{
        s.classList.remove("active");
      });
      document.getElementById("tab-" + name).classList.add("active");

      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      if(btn) btn.classList.add("active");
    }

    // Admin check
    const me = getCurrentUser();
    if(!me || me.role !== "admin"){
      alert("Admin panel ‡¶è ‡¶¢‡ßÅ‡¶ï‡¶§‡ßá admin ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá login ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá (demo).");
      window.location.href = "login.html";
    }

    // ====== USERS TAB ======
    let users = loadUsers();

    const userTbody = document.getElementById("userTableBody");

    function renderUsers(){
      users = loadUsers();
      users.sort((a,b)=> (a.createdAt || "").localeCompare(b.createdAt || ""));
      userTbody.innerHTML = "";

      users.forEach(u=>{
        const tr = document.createElement("tr");
        const dt = u.createdAt ? new Date(u.createdAt).toLocaleString() : "-";
        tr.innerHTML = `
          <td>${u.username || ""}</td>
          <td>${u.fullName || ""}</td>
          <td>${u.email || ""}</td>
          <td>${u.mobile || ""}</td>
          <td>${u.country || ""}</td>
          <td>${u.role || "member"}</td>
          <td>${u.membershipType || "free"}</td>
          <td>$${(u.balance || 0).toFixed(2)}</td>
          <td>${u.teamCount || 0}</td>
          <td>${u.refCode || ""}</td>
          <td>${dt}</td>
          <td>
            <button class="btn-table btn-edit" onclick="editUser(${u.id})">Edit</button>
          </td>
        `;
        userTbody.appendChild(tr);
      });
    }

    function editUser(id){
      const u = users.find(x=> x.id === id);
      if(!u){
        alert("User ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø.");
        return;
      }
      document.getElementById("editUserId").value       = u.id;
      document.getElementById("editUsername").value     = u.username || "";
      document.getElementById("editFullName").value     = u.fullName || "";
      document.getElementById("editEmail").value        = u.email || "";
      document.getElementById("editMobile").value       = u.mobile || "";
      document.getElementById("editCountry").value      = u.country || "";
      document.getElementById("editRole").value         = u.role || "member";
      document.getElementById("editMembership").value   = u.membershipType || "free";
      document.getElementById("editBalance").value      = (u.balance || 0);
      document.getElementById("editDepositTotal").value = (u.depositTotal || 0);
      document.getElementById("editDirectIncome").value = (u.directIncome || 0);
      document.getElementById("editTeamIncome").value   = (u.teamIncome || 0);
      document.getElementById("editTeamCount").value    = (u.teamCount || 0);
      document.getElementById("editRefCode").value      = u.refCode || "";
      document.getElementById("editSponsor").value      = u.sponsor_username || "";
      document.getElementById("editPassword").value     = u.password || "";
    }

    document.getElementById("editUserForm").addEventListener("submit",(e)=>{
      e.preventDefault();
      const id = parseInt(document.getElementById("editUserId").value,10);
      if(!id){alert("Select someone first.");return;}

      let list = loadUsers();
      const idx = list.findIndex(u=>u.id === id);
      if(idx < 0){alert("User ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø.");return;}

      const u = list[idx];

      u.fullName         = document.getElementById("editFullName").value.trim();
      u.email            = document.getElementById("editEmail").value.trim().toLowerCase();
      u.mobile           = document.getElementById("editMobile").value.trim();
      u.country          = document.getElementById("editCountry").value.trim();
      u.role             = document.getElementById("editRole").value;
      u.membershipType   = document.getElementById("editMembership").value;
      u.balance          = parseFloat(document.getElementById("editBalance").value || "0");
      u.depositTotal     = parseFloat(document.getElementById("editDepositTotal").value || "0");
      u.directIncome     = parseFloat(document.getElementById("editDirectIncome").value || "0");
      u.teamIncome       = parseFloat(document.getElementById("editTeamIncome").value || "0");
      u.teamCount        = parseInt(document.getElementById("editTeamCount").value || "0",10);
      u.refCode          = document.getElementById("editRefCode").value.trim();
      u.sponsor_username = document.getElementById("editSponsor").value.trim();
      u.password         = document.getElementById("editPassword").value;

      list[idx] = u;
      saveUsers(list);

      if(me.id === u.id){
        localStorage.setItem(STORAGE_CURRENT, JSON.stringify(u));
      }

      alert("Member updated (demo).");
      users = list;
      renderUsers();
    });

    // ====== DEPOSITS TAB ======
    const depTbody = document.getElementById("depAdminBody");

    function renderDeposits(){
      let deps = loadDeposits();
      deps.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      depTbody.innerHTML = "";

      deps.forEach(d=>{
        const tr = document.createElement("tr");
        const dt = new Date(d.createdAt);
        const stClass =
          d.status === "approved" ? "status-approved":
          d.status === "rejected" ? "status-rejected":"status-pending";

        let actionHtml = "";
        if(d.status === "pending"){
          actionHtml = `
            <button class="btn-table btn-approve" onclick="approveDeposit(${d.id})">Approve</button>
            <button class="btn-table btn-reject" onclick="rejectDeposit(${d.id})">Reject</button>
          `;
        }

        tr.innerHTML = `
          <td>${dt.toLocaleString()}</td>
          <td>${d.username || d.userId}</td>
          <td>$${d.amount.toFixed(2)}</td>
          <td>${d.method}</td>
          <td>${d.txn}</td>
          <td class="${stClass}">${d.status}</td>
          <td>${actionHtml}</td>
        `;
        depTbody.appendChild(tr);
      });
    }

    window.approveDeposit = function(id){
      let deps = loadDeposits();
      const idx = deps.findIndex(x=>x.id === id);
      if(idx < 0){alert("Deposit not found.");return;}
      let d = deps[idx];
      if(d.status !== "pending"){
        alert("Already processed.");
        return;
      }

      let us = loadUsers();
      const uIdx = us.findIndex(u=>u.id === d.userId);
      if(uIdx < 0){
        alert("User ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø, ‡¶∂‡ßÅ‡¶ß‡ßÅ status ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§");
      }else{
        us[uIdx].balance      = (us[uIdx].balance || 0) + d.amount;
        us[uIdx].depositTotal = (us[uIdx].depositTotal || 0) + d.amount;
        saveUsers(us);
      }

      d.status = "approved";
      d.approvedAt = new Date().toISOString();
      deps[idx] = d;
      saveDeposits(deps);

      alert("Deposit approved (demo).");
      renderDeposits();
      renderUsers();
    };

    window.rejectDeposit = function(id){
      let deps = loadDeposits();
      const idx = deps.findIndex(x=>x.id === id);
      if(idx < 0){alert("Deposit not found.");return;}
      let d = deps[idx];
      if(d.status !== "pending"){
        alert("Already processed.");
        return;
      }
      d.status = "rejected";
      d.approvedAt = new Date().toISOString();
      deps[idx] = d;
      saveDeposits(deps);
      alert("Deposit rejected (demo).");
      renderDeposits();
    };

    // ====== WITHDRAWS TAB ======
    const wdTbody = document.getElementById("wdAdminBody");

    function renderWithdraws(){
      let list = loadWithdraws();
      list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      wdTbody.innerHTML = "";

      list.forEach(w=>{
        const tr = document.createElement("tr");
        const dt = new Date(w.createdAt);
        const stClass =
          w.status === "approved" ? "status-approved":
          w.status === "rejected" ? "status-rejected":"status-pending";

        let actionHtml = "";
        if(w.status === "pending"){
          actionHtml = `
            <button class="btn-table btn-approve" onclick="approveWithdraw(${w.id})">Approve</button>
            <button class="btn-table btn-reject" onclick="rejectWithdraw(${w.id})">Reject</button>
          `;
        }

        tr.innerHTML = `
          <td>${dt.toLocaleString()}</td>
          <td>${w.username || w.userId}</td>
          <td>$${w.amount.toFixed(2)}</td>
          <td>${w.method}</td>
          <td>${w.wallet}</td>
          <td class="${stClass}">${w.status}</td>
          <td>${actionHtml}</td>
        `;
        wdTbody.appendChild(tr);
      });
    }

    window.approveWithdraw = function(id){
      let list = loadWithdraws();
      const idx = list.findIndex(x=>x.id === id);
      if(idx < 0){alert("Withdraw not found.");return;}
      let w = list[idx];
      if(w.status !== "pending"){
        alert("Already processed.");
        return;
      }

      let us = loadUsers();
      const uIdx = us.findIndex(u=>u.id === w.userId);
      if(uIdx < 0){
        alert("User ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø, withdraw APPROVE ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ (demo).");
        return;
      }

      const bal = us[uIdx].balance || 0;
      if(bal < w.amount){
        alert("User balance ‡¶ï‡¶Æ ‡¶Ü‡¶õ‡ßá ‚Äì auto reject ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã (demo).");
        w.status = "rejected";
        w.approvedAt = new Date().toISOString();
        list[idx] = w;
        saveWithdraws(list);
        renderWithdraws();
        return;
      }

      us[uIdx].balance = bal - w.amount;
      saveUsers(us);

      w.status = "approved";
      w.approvedAt = new Date().toISOString();
      list[idx] = w;
      saveWithdraws(list);

      alert("Withdraw approved (demo).");
      renderWithdraws();
      renderUsers();
    };

    window.rejectWithdraw = function(id){
      let list = loadWithdraws();
      const idx = list.findIndex(x=>x.id === id);
      if(idx < 0){alert("Withdraw not found.");return;}
      let w = list[idx];
      if(w.status !== "pending"){
        alert("Already processed.");
        return;
      }
      w.status = "rejected";
      w.approvedAt = new Date().toISOString();
      list[idx] = w;
      saveWithdraws(list);
      alert("Withdraw rejected (demo).");
      renderWithdraws();
    };

    // INIT RENDER
    renderUsers();
    renderDeposits();
    renderWithdraws();
  </script>
</body>
</html>